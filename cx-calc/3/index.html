<!DOCTYPE html> <html lang="bg"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Safari Calculator Test</title> <style> * { margin: 0; padding: 0; box-sizing: border-box; -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; -webkit-user-drag: none; -khtml-user-drag: none; -moz-user-drag: none; -o-user-drag: none; user-drag: none; } body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; } .calculator { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); max-width: 350px; width: 100%; } .display-container { background: #000; border-radius: 15px; padding: 20px; margin-bottom: 20px; position: relative; } .display { color: white; font-size: 2.5em; text-align: right; min-height: 60px; display: flex; align-items: center; justify-content: flex-end; overflow: hidden; } .secondary-display { color: #888; font-size: 1.2em; text-align: right; margin-bottom: 10px; min-height: 25px; } .status-indicator { position: absolute; top: 10px; left: 10px; background: #ff6b6b; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8em; opacity: 0; transition: opacity 0.3s ease; } .status-indicator.show { opacity: 1; } .buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; } .btn { height: 70px; border: none; border-radius: 15px; font-size: 1.4em; font-weight: bold; cursor: pointer; transition: all 0.2s ease; position: relative; overflow: hidden; touch-action: manipulation; -webkit-touch-callout: none; -webkit-user-select: none; -webkit-tap-highlight-color: transparent; -webkit-appearance: none; } .btn:active { transform: scale(0.95); } .btn.number { background: #f8f9fa; color: #333; } .btn.operator { background: #ff6b6b; color: white; } .btn.function { background: #4ecdc4; color: white; } .btn.special { background: #45b7d1; color: white; } .btn.pressed { background: #333 !important; color: white !important; transform: scale(0.9); } .btn.long-press { animation: longPressAnimation 0.8s ease-in-out; } @keyframes longPressAnimation { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); } 50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 107, 107, 0.3); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); } } .btn::after { content: attr(data-long-text); position: absolute; top: 5px; right: 5px; font-size: 0.7em; opacity: 0.6; pointer-events: none; } .memory-display { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9em; color: #666; } .memory-slot { padding: 5px 10px; background: #f0f0f0; border-radius: 10px; min-width: 60px; text-align: center; } .instructions { margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.7); border-radius: 10px; font-size: 0.9em; line-height: 1.4; } .vibrate-test { margin-top: 10px; text-align: center; } .vibrate-btn { background: #9b59b6; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-size: 1em; cursor: pointer; } </style> </head> <body> <div class="calculator"> <div class="display-container"> <div class="status-indicator" id="statusIndicator">Long Press Detected!</div> <div class="secondary-display" id="secondaryDisplay">0</div> <div class="display" id="display">0</div> </div> <div class="memory-display"> <div class="memory-slot" id="mem1">M1: 0</div> <div class="memory-slot" id="mem2">M2: 0</div> <div class="memory-slot" id="mem3">M3: 0</div> </div> <div class="buttons"> <button class="btn function" data-action="clear" data-long-text="AC">C</button> <button class="btn function" data-action="memory" data-long-text="MC">M</button> <button class="btn function" data-action="percent" data-long-text="√">%</button> <button class="btn operator" data-action="divide" data-long-text="1/x">÷</button> <button class="btn number" data-value="7" data-long-text="sin">7</button> <button class="btn number" data-value="8" data-long-text="cos">8</button> <button class="btn number" data-value="9" data-long-text="tan">9</button> <button class="btn operator" data-action="multiply" data-long-text="x²">×</button> <button class="btn number" data-value="4" data-long-text="ln">4</button> <button class="btn number" data-value="5" data-long-text="log">5</button> <button class="btn number" data-value="6" data-long-text="x^y">6</button> <button class="btn operator" data-action="subtract" data-long-text="±">-</button> <button class="btn number" data-value="1" data-long-text="π">1</button> <button class="btn number" data-value="2" data-long-text="e">2</button> <button class="btn number" data-value="3" data-long-text="!">3</button> <button class="btn operator" data-action="add" data-long-text="Σ">+</button> <button class="btn special" data-action="zero" data-long-text="000">0</button> <button class="btn number" data-value="." data-long-text=",">,</button> <button class="btn function" data-action="delete" data-long-text="⌫">⌫</button> <button class="btn operator" data-action="equals" data-long-text="=">=</button> </div> <div class="vibrate-test"> <button class="vibrate-btn" onclick="testVibration()">Test Safari Vibration</button> </div> <div class="instructions"> <strong>Тестове за Safari:</strong><br> • <strong>Задръж бутон</strong> - появява се алтернативна функция<br> • <strong>Бързо докосване</strong> - нормална функция<br> • <strong>Памет</strong> - Задръж M за различни слотове<br> • <strong>Вибрация</strong> - тествай дали работи в Safari<br> • <strong>Touch events</strong> - оптимизирани за iOS </div> </div> <script> let display = document.getElementById('display'); let secondaryDisplay = document.getElementById('secondaryDisplay'); let statusIndicator = document.getElementById('statusIndicator'); let currentValue = '0'; let previousValue = ''; let operator = null; let waitingForNumber = false; let memory = [0, 0, 0]; let currentMemorySlot = 0; let longPressTimer = null; let longPressTriggered = false; const LONG_PRESS_DURATION = 600; // 600ms за Safari // Обновява дисплея function updateDisplay() { display.textContent = currentValue; updateMemoryDisplay(); } function updateMemoryDisplay() { document.getElementById('mem1').textContent = `M1: ${memory[0]}`; document.getElementById('mem2').textContent = `M2: ${memory[1]}`; document.getElementById('mem3').textContent = `M3: ${memory[2]}`; } function showStatus(message) { statusIndicator.textContent = message; statusIndicator.classList.add('show'); setTimeout(() => { statusIndicator.classList.remove('show'); }, 2000); } function vibrate(pattern = [100]) { if ('vibrate' in navigator) { navigator.vibrate(pattern); console.log('Vibration triggered:', pattern); } else { console.log('Vibration not supported'); } } function testVibration() { vibrate([200, 100, 200]); showStatus('Vibration Test!'); } // Функции за long press function startLongPress(element) { longPressTriggered = false; element.classList.add('pressed'); longPressTimer = setTimeout(() => { longPressTriggered = true; element.classList.add('long-press'); vibrate([50, 50, 100]); handleLongPress(element); }, LONG_PRESS_DURATION); } function cancelLongPress(element) { if (longPressTimer) { clearTimeout(longPressTimer); longPressTimer = null; } element.classList.remove('pressed', 'long-press'); } function handleLongPress(element) { const action = element.dataset.action; const value = element.dataset.value; const longText = element.dataset.longText; showStatus(`Long Press: ${longText}`); switch(action) { case 'clear': // AC - изтрива всичко currentValue = '0'; previousValue = ''; operator = null; memory = [0, 0, 0]; secondaryDisplay.textContent = 'All Clear'; break; case 'memory': // MC - Memory Clear memory[currentMemorySlot] = 0; showStatus(`Memory ${currentMemorySlot + 1} cleared`); break; case 'percent': // Square root const num = parseFloat(currentValue); currentValue = Math.sqrt(num).toString(); showStatus('√ Square Root'); break; case 'zero': // 000 if (currentValue === '0') { currentValue = '000'; } else { currentValue += '000'; } break; } // Специални функции за числа if (value) { switch(value) { case '1': currentValue = Math.PI.toString(); showStatus('π Pi'); break; case '2': currentValue = Math.E.toString(); showStatus('e Euler'); break; case '7': const sinVal = Math.sin(parseFloat(currentValue) * Math.PI / 180); currentValue = sinVal.toString(); showStatus('sin function'); break; case '8': const cosVal = Math.cos(parseFloat(currentValue) * Math.PI / 180); currentValue = cosVal.toString(); showStatus('cos function'); break; } } updateDisplay(); } function handleShortPress(element) { if (longPressTriggered) return; const action = element.dataset.action; const value = element.dataset.value; if (value !== undefined) { if (waitingForNumber || currentValue === '0') { currentValue = value; waitingForNumber = false; } else { if (value === '.') { if (!currentValue.includes('.')) { currentValue += value; } } else { currentValue += value; } } } switch(action) { case 'clear': currentValue = '0'; secondaryDisplay.textContent = '0'; break; case 'memory': // Cycle through memory slots currentMemorySlot = (currentMemorySlot + 1) % 3; memory[currentMemorySlot] = parseFloat(currentValue) || 0; showStatus(`Stored in M${currentMemorySlot + 1}`); break; case 'add': case 'subtract': case 'multiply': case 'divide': if (operator && !waitingForNumber) { calculate(); } operator = action; previousValue = currentValue; waitingForNumber = true; secondaryDisplay.textContent = `${previousValue} ${getOperatorSymbol(action)}`; break; case 'equals': calculate(); break; case 'delete': if (currentValue.length > 1) { currentValue = currentValue.slice(0, -1); } else { currentValue = '0'; } break; } vibrate([30]); updateDisplay(); } function getOperatorSymbol(op) { switch(op) { case 'add': return '+'; case 'subtract': return '-'; case 'multiply': return '×'; case 'divide': return '÷'; default: return ''; } } function calculate() { if (!operator || waitingForNumber) return; const prev = parseFloat(previousValue); const current = parseFloat(currentValue); let result = 0; switch(operator) { case 'add': result = prev + current; break; case 'subtract': result = prev - current; break; case 'multiply': result = prev * current; break; case 'divide': if (current !== 0) { result = prev / current; } else { showStatus('Error: Division by zero'); return; } break; } currentValue = result.toString(); operator = null; previousValue = ''; waitingForNumber = true; secondaryDisplay.textContent = `= ${result}`; } // Event listeners optimized for Safari/iOS document.querySelectorAll('.btn').forEach(button => { let touchStartTime = 0; let touchStartPos = { x: 0, y: 0 }; // Touch events for better iOS support button.addEventListener('touchstart', (e) => { e.preventDefault(); e.stopPropagation(); touchStartTime = Date.now(); const touch = e.touches[0]; touchStartPos = { x: touch.clientX, y: touch.clientY }; startLongPress(button); }, { passive: false, capture: true }); button.addEventListener('touchmove', (e) => { e.preventDefault(); e.stopPropagation(); // Cancel if moved too much const touch = e.touches[0]; const deltaX = Math.abs(touch.clientX - touchStartPos.x); const deltaY = Math.abs(touch.clientY - touchStartPos.y); if (deltaX > 10 || deltaY > 10) { cancelLongPress(button); } }, { passive: false, capture: true }); button.addEventListener('touchend', (e) => { e.preventDefault(); e.stopPropagation(); cancelLongPress(button); // Only handle if touch duration is short enough for tap const touchDuration = Date.now() - touchStartTime; if (touchDuration < LONG_PRESS_DURATION) { handleShortPress(button); } }, { passive: false, capture: true }); button.addEventListener('touchcancel', (e) => { e.preventDefault(); e.stopPropagation(); cancelLongPress(button); }, { passive: false, capture: true }); // Mouse events for desktop testing button.addEventListener('mousedown', (e) => { e.preventDefault(); e.stopPropagation(); startLongPress(button); }, { capture: true }); button.addEventListener('mouseup', (e) => { e.preventDefault(); e.stopPropagation(); cancelLongPress(button); handleShortPress(button); }, { capture: true }); button.addEventListener('mouseleave', (e) => { cancelLongPress(button); }); // Additional iOS specific events button.addEventListener('contextmenu', (e) => { e.preventDefault(); e.stopPropagation(); return false; }, { capture: true }); button.addEventListener('selectstart', (e) => { e.preventDefault(); e.stopPropagation(); return false; }, { capture: true }); }); // Prevent context menu globally document.addEventListener('contextmenu', (e) => { e.preventDefault(); e.stopPropagation(); return false; }, { passive: false, capture: true }); // Prevent text selection globally document.addEventListener('selectstart', (e) => { e.preventDefault(); return false; }, { passive: false }); // Additional iOS/Safari fixes document.addEventListener('touchstart', (e) => { // Only prevent on buttons, allow other elements if (e.target.classList.contains('btn')) { e.preventDefault(); } }, { passive: false }); // Initial display updateDisplay(); showStatus('Ready for Safari testing!'); console.log('Safari Calculator Test loaded successfully!'); console.log('Features: Long press, vibration, memory, touch optimization'); </script> </body> </html>